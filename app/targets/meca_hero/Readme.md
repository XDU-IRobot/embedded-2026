# 底盘结构
- 轮子：Dji M3508*4
- 弹仓拨盘：DM J4310
- YAW轴：DM J4310
# CAN分配
- CAN2
  - 底盘、云台
- CAN1
  - 弹仓拨盘、摩擦轮
# 拨盘电机id
![屏幕截图 2026-01-18 151920.png](%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202026-01-18%20151920.png)
# 行动模式
## 无力模式
- **左：任意||右：Down**
## 调试模式（仅云台底盘）
- **左：Down||右：Mid**
## 随动模式
- **左：Mid||右：Mid**
## 开火模式（关闭随动，启动摩擦轮、拨盘）
- **左：Up||右：Mid**
## 爬坡模式（解开功率限制、锁定pitch轴（断电））
- 爬坡（底盘超功率）（建议开启随动）
- **左：任意||右：Up**

- 
---
# 裁判系统
## 底盘功率控制✅
## 弹速控制❌
- 弹速尽量一致
- 摩擦轮转速曲线
  - 降幅一致且尽量少
- 可调整弹速
## 
# 拨盘✅
- 上电
  - 不能动
  - target = now
  - next找到最近的大于now的限位
- 拨动扳机
  - 堵转检测&&摩擦轮转速检测
    - 堵住target>now
      - next不动，target=now-2°
    - 未堵住
      - target=next
      - next+60
# 上坡✅
- 功率模型本身已解决该问题
## 上坡模式：低速高扭矩
### 低速大电流（不空转不卡死）
- 速度目标值改小，PID的P值和D值调大
  - ERROR：测量目标速度和0的差值
  - OUT：测量上坡状态不卡死的最小力矩（电流）
    - 计算所需PID
# IMU零飘
- 陀螺仪gyro_z值趋于0
  - 采样取平均，减去该值
  - 给gyro_z加滤波
# pitch轴、随动PID
- 双环PID
- 系统辨识
- 经验法
---
# 问题
## (已解决，目前删除HAL_Delay也无影响，神秘）拨盘任务中，达妙电机失能指令前必须加HAL_Delay，否则失能指令发不出去，且由于神秘原因会导致PID非常抖，完全调不好。
- 加了HAL_Delay后，PID参数没变，但现象就变正常，完全不抖了。发送失能和发送使能、PID计算、CAN数据包发送分别在两个if里，且两个if完全互斥，想不明白为什么在失能if里加了HAL Delay会影响另一个if
## 云台任务最开头本来调用了一次DR16的取值方法，但是这同样会造成失能指令无法发送，第一条的方法也不起作用。
- 将遥控器取值方法注释掉即可正常运行
## 调云台时，阻碍达妙电机移动一段时间后会进入错误模式（调试助手上看是通讯丢失）
- 在程序中给电机发送清除错误指令即可，但必须在使能前
  ### 但清除错误后红色闪灯并没消失，进入使能模式时是红灯常亮，失能是红灯闪烁，但工作似乎是正常的
